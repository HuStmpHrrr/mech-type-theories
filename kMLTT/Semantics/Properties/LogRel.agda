{-# OPTIONS --without-K --safe #-}

open import Level using ()
open import Axiom.Extensionality.Propositional

module kMLTT.Semantics.Properties.LogRel (fext : âˆ€ {â„“ â„“â€²} â†’ Extensionality â„“ â„“â€²) where

open import Relation.Binary using (PartialSetoid; IsPartialEquivalence)
import Relation.Binary.Reasoning.PartialSetoid as PS

open import Lib
open import kMLTT.Semantics.Domain
open import kMLTT.Semantics.Evaluation
open import kMLTT.Semantics.PER
open import kMLTT.Semantics.LogRel

open import kMLTT.Semantics.Properties.Domain fext
open import kMLTT.Semantics.Properties.PER fext

mutual

  âŠ¨-sym : âŠ¨ Î“ â‰ˆ Î” â†’ âŠ¨ Î” â‰ˆ Î“
  âŠ¨-sym []-â‰ˆ                              = []-â‰ˆ
  âŠ¨-sym (Îº-cong Î“â‰ˆÎ”)                      = Îº-cong (âŠ¨-sym Î“â‰ˆÎ”)
  âŠ¨-sym (âˆ·-cong {Î“} {Î”} {T} {Tâ€²} Î“â‰ˆÎ” rel) = âˆ·-cong (âŠ¨-sym Î“â‰ˆÎ”) helper
    where helper : Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ âŠ¨-sym Î“â‰ˆÎ” âŸ§Ï â†’ RelTyp Tâ€² Ï T Ïâ€²
          helper Ïâ‰ˆÏâ€² = record
            { âŸ¦TâŸ§   = âŸ¦Tâ€²âŸ§
            ; âŸ¦Tâ€²âŸ§  = âŸ¦TâŸ§
            ; â†˜âŸ¦TâŸ§  = â†˜âŸ¦Tâ€²âŸ§
            ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦TâŸ§
            ; Tâ‰ˆTâ€²  = ğ•Œâˆ-sym Tâ‰ˆTâ€²
            ; nat   = natâ€²
            ; natâ€²  = nat
            }
            where open RelTyp (rel (âŸ¦âŸ§Ï-sym (âŠ¨-sym Î“â‰ˆÎ”) Î“â‰ˆÎ” Ïâ‰ˆÏâ€²))

  âŸ¦âŸ§Ï-sym : (Î“â‰ˆÎ” : âŠ¨ Î“ â‰ˆ Î”) (Î”â‰ˆÎ“ : âŠ¨ Î” â‰ˆ Î“) â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ” âŸ§Ï â†’ Ïâ€² â‰ˆ Ï âˆˆ âŸ¦ Î”â‰ˆÎ“ âŸ§Ï
  âŸ¦âŸ§Ï-sym []-â‰ˆ []-â‰ˆ Ïâ‰ˆÏâ€²                        = tt
  âŸ¦âŸ§Ï-sym (Îº-cong Î“â‰ˆÎ”) (Îº-cong Î”â‰ˆÎ“) (Ïâ‰ˆÏâ€² , eq) = âŸ¦âŸ§Ï-sym Î“â‰ˆÎ” Î”â‰ˆÎ“ Ïâ‰ˆÏâ€² , sym eq
  âŸ¦âŸ§Ï-sym {_} {_} {Ï} {Ïâ€²} (âˆ·-cong Î“â‰ˆÎ” RT) (âˆ·-cong Î”â‰ˆÎ“ RTâ€²) (Ïâ‰ˆÏâ€² , Ï0â‰ˆÏâ€²0)
    with âŸ¦âŸ§Ï-sym Î“â‰ˆÎ” Î”â‰ˆÎ“ Ïâ‰ˆÏâ€²
  ...  | Ïâ€²â‰ˆÏ                                   = Ïâ€²â‰ˆÏ , helper
    where helper : lookup Ïâ€² 0 â‰ˆ lookup Ï 0 âˆˆ Elâˆ (RelTyp.Tâ‰ˆTâ€² (RTâ€² Ïâ€²â‰ˆÏ))
          helper
            with RT Ïâ‰ˆÏâ€² | RTâ€² Ïâ€²â‰ˆÏ
          ...  | record { â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§  ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§  ; Tâ‰ˆTâ€² = i , Tâ‰ˆTâ€² }
               | record { â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§â‚ ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§â‚ ; Tâ‰ˆTâ€² = j , Tâ‰ˆTâ€²â‚ }
               rewrite âŸ¦âŸ§-det â†˜âŸ¦Tâ€²âŸ§ â†˜âŸ¦TâŸ§â‚
                     | âŸ¦âŸ§-det â†˜âŸ¦TâŸ§ â†˜âŸ¦Tâ€²âŸ§â‚ = ğ•Œ-irrel (ğ•Œ-sym Tâ‰ˆTâ€²) Tâ‰ˆTâ€²â‚ (El-sym Tâ‰ˆTâ€² (ğ•Œ-sym Tâ‰ˆTâ€²) Ï0â‰ˆÏâ€²0)


âŸ¦âŸ§Ï-one-sided : (Î“â‰ˆÎ” : âŠ¨ Î“ â‰ˆ Î”) (Î“â‰ˆÎ”â€² : âŠ¨ Î“ â‰ˆ Î”â€²) â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ” âŸ§Ï â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ”â€² âŸ§Ï
âŸ¦âŸ§Ï-one-sided []-â‰ˆ []-â‰ˆ Ïâ‰ˆÏâ€²                                    = tt
âŸ¦âŸ§Ï-one-sided (Îº-cong Î“â‰ˆÎ”) (Îº-cong Î“â‰ˆÎ”â€²) (Ïâ‰ˆÏâ€² , eq)            = âŸ¦âŸ§Ï-one-sided Î“â‰ˆÎ” Î“â‰ˆÎ”â€² Ïâ‰ˆÏâ€² , eq
âŸ¦âŸ§Ï-one-sided {_} {_} {_} {Ï} {Ïâ€²} (âˆ·-cong Î“â‰ˆÎ” RT) (âˆ·-cong Î“â‰ˆÎ”â€² RTâ€²) (Ïâ‰ˆÏâ€² , Ï0â‰ˆÏâ€²0)
  with âŸ¦âŸ§Ï-one-sided Î“â‰ˆÎ” Î“â‰ˆÎ”â€² Ïâ‰ˆÏâ€²
...  | Ïâ‰ˆÏâ€²â‚ = Ïâ‰ˆÏâ€²â‚ , helper
    where helper : lookup Ï 0 â‰ˆ lookup Ïâ€² 0 âˆˆ Elâˆ (RelTyp.Tâ‰ˆTâ€² (RTâ€² Ïâ‰ˆÏâ€²â‚))
          helper
            with RT Ïâ‰ˆÏâ€² | RTâ€² Ïâ‰ˆÏâ€²â‚
          ...  | record { â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§  ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§  ; Tâ‰ˆTâ€² = i , Tâ‰ˆTâ€² }
               | record { â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§â‚ ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§â‚ ; Tâ‰ˆTâ€² = j , Tâ‰ˆTâ€²â‚ }
               rewrite âŸ¦âŸ§-det â†˜âŸ¦TâŸ§ â†˜âŸ¦TâŸ§â‚ = El-one-sided Tâ‰ˆTâ€² Tâ‰ˆTâ€²â‚ Ï0â‰ˆÏâ€²0


âŠ¨-irrel : (Î“â‰ˆÎ” Î“â‰ˆÎ”â€² : âŠ¨ Î“ â‰ˆ Î”) â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ” âŸ§Ï â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ”â€² âŸ§Ï
âŠ¨-irrel = âŸ¦âŸ§Ï-one-sided


âŸ¦âŸ§Ï-one-sidedâ€² : (Î“â‰ˆÎ” : âŠ¨ Î“ â‰ˆ Î”) (Î“â€²â‰ˆÎ” : âŠ¨ Î“â€² â‰ˆ Î”) â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ” âŸ§Ï â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â€²â‰ˆÎ” âŸ§Ï
âŸ¦âŸ§Ï-one-sidedâ€² Î“â‰ˆÎ” Î“â€²â‰ˆÎ” Ïâ‰ˆÏâ€² = âŸ¦âŸ§Ï-sym (âŠ¨-sym Î“â€²â‰ˆÎ”) Î“â€²â‰ˆÎ” (âŸ¦âŸ§Ï-one-sided (âŠ¨-sym Î“â‰ˆÎ”) (âŠ¨-sym Î“â€²â‰ˆÎ”) (âŸ¦âŸ§Ï-sym Î“â‰ˆÎ” (âŠ¨-sym Î“â‰ˆÎ”) Ïâ‰ˆÏâ€²))

mutual

  âŠ¨-trans : âŠ¨ Î“ â‰ˆ Î“â€² â†’ âŠ¨ Î“â€² â‰ˆ Î“â€³ â†’ âŠ¨ Î“ â‰ˆ Î“â€³
  âŠ¨-trans []-â‰ˆ []-â‰ˆ                                                             = []-â‰ˆ
  âŠ¨-trans (Îº-cong Î“â‰ˆÎ“â€²) (Îº-cong Î“â€²â‰ˆÎ“â€³)                                          = Îº-cong (âŠ¨-trans Î“â‰ˆÎ“â€² Î“â€²â‰ˆÎ“â€³)
  âŠ¨-trans (âˆ·-cong {_} {_} {T} {Tâ€²} Î“â‰ˆÎ“â€² RT) (âˆ·-cong {_} {_} {_} {Tâ€³} Î“â€²â‰ˆÎ“â€³ RTâ€²) = âˆ·-cong (âŠ¨-trans Î“â‰ˆÎ“â€² Î“â€²â‰ˆÎ“â€³) helper
    where helper : Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ âŠ¨-trans Î“â‰ˆÎ“â€² Î“â€²â‰ˆÎ“â€³ âŸ§Ï â†’ RelTyp T Ï Tâ€³ Ïâ€²
          helper Ïâ‰ˆÏâ€²
            with âŠ¨-refl Î“â‰ˆÎ“â€²
          ...  | Î“â‰ˆÎ“
               with RT (âŸ¦âŸ§Ï-one-sided Î“â‰ˆÎ“ Î“â‰ˆÎ“â€² (âŸ¦âŸ§Ï-refl (âŠ¨-trans Î“â‰ˆÎ“â€² Î“â€²â‰ˆÎ“â€³) Î“â‰ˆÎ“ Ïâ‰ˆÏâ€²))
                  | RTâ€² (âŸ¦âŸ§Ï-one-sidedâ€² (âŠ¨-trans Î“â‰ˆÎ“â€² Î“â€²â‰ˆÎ“â€³) Î“â€²â‰ˆÎ“â€³ Ïâ‰ˆÏâ€²)
          ...     | record { â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§  ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§  ; Tâ‰ˆTâ€² = Tâ‰ˆTâ€²  ; nat = nat }
                  | record { â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§â‚ ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§â‚ ; Tâ‰ˆTâ€² = Tâ‰ˆTâ€²â‚ ; natâ€² = natâ€² }
                  rewrite âŸ¦âŸ§-det â†˜âŸ¦Tâ€²âŸ§ â†˜âŸ¦TâŸ§â‚ = record
            { âŸ¦TâŸ§   = _
            ; âŸ¦Tâ€²âŸ§  = _
            ; â†˜âŸ¦TâŸ§  = â†˜âŸ¦TâŸ§
            ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§â‚
            ; Tâ‰ˆTâ€²  = ğ•Œâˆ-trans Tâ‰ˆTâ€² Tâ‰ˆTâ€²â‚
            ; nat   = nat
            ; natâ€²  = natâ€²
            }

  âŸ¦âŸ§Ï-trans : (Î“â‰ˆÎ“â€² : âŠ¨ Î“ â‰ˆ Î“â€²) (Î“â€²â‰ˆÎ“â€³ : âŠ¨ Î“â€² â‰ˆ Î“â€³) (Î“â‰ˆÎ“â€³ : âŠ¨ Î“ â‰ˆ Î“â€³) â†’
              Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ“â€² âŸ§Ï â†’ Ïâ€² â‰ˆ Ïâ€³ âˆˆ âŸ¦ Î“â€²â‰ˆÎ“â€³ âŸ§Ï â†’ Ï â‰ˆ Ïâ€³ âˆˆ âŸ¦ Î“â‰ˆÎ“â€³ âŸ§Ï
  âŸ¦âŸ§Ï-trans []-â‰ˆ []-â‰ˆ []-â‰ˆ Ïâ‰ˆÏâ€² Ïâ€²â‰ˆÏâ€³                                            = tt
  âŸ¦âŸ§Ï-trans (Îº-cong Î“â‰ˆÎ“â€²) (Îº-cong Î“â€²â‰ˆÎ“â€³) (Îº-cong Î“â‰ˆÎ“â€³) (Ïâ‰ˆÏâ€² , eq) (Ïâ€²â‰ˆÏâ€³ , eqâ€²) = âŸ¦âŸ§Ï-trans Î“â‰ˆÎ“â€² Î“â€²â‰ˆÎ“â€³ Î“â‰ˆÎ“â€³ Ïâ‰ˆÏâ€² Ïâ€²â‰ˆÏâ€³ , trans eq eqâ€²
  âŸ¦âŸ§Ï-trans {_} {_} {_} {Ï} {Ïâ€²} {Ïâ€³} (âˆ·-cong Î“â‰ˆÎ“â€² RT) (âˆ·-cong Î“â€²â‰ˆÎ“â€³ RTâ€²) (âˆ·-cong Î“â‰ˆÎ“â€³ RTâ€³) (Ïâ‰ˆÏâ€² , Ï0â‰ˆÏâ€²0) (Ïâ€²â‰ˆÏâ€³ , Ïâ€²0â‰ˆÏâ€³0)
    with âŸ¦âŸ§Ï-trans Î“â‰ˆÎ“â€² Î“â€²â‰ˆÎ“â€³ Î“â‰ˆÎ“â€³ Ïâ‰ˆÏâ€² Ïâ€²â‰ˆÏâ€³
  ...  | Ïâ‰ˆÏâ€³                                                                    = Ïâ‰ˆÏâ€³ , helper
    where helper : lookup Ï 0 â‰ˆ lookup Ïâ€³ 0 âˆˆ Elâˆ (RelTyp.Tâ‰ˆTâ€² (RTâ€³ Ïâ‰ˆÏâ€³))
          helper
            with RT Ïâ‰ˆÏâ€² | RTâ€² Ïâ€²â‰ˆÏâ€³ | RTâ€³ Ïâ‰ˆÏâ€³
          ...  | record { â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§  ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§  ; Tâ‰ˆTâ€² = i , Tâ‰ˆTâ€² }
               | record { â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§â‚ ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§â‚ ; Tâ‰ˆTâ€² = j , Tâ‰ˆTâ€²â‚ }
               | record { â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§â‚‚ ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§â‚‚ ; Tâ‰ˆTâ€² = k , Tâ‰ˆTâ€²â‚‚ }
               rewrite âŸ¦âŸ§-det â†˜âŸ¦Tâ€²âŸ§ â†˜âŸ¦TâŸ§â‚
                     | âŸ¦âŸ§-det â†˜âŸ¦TâŸ§ â†˜âŸ¦TâŸ§â‚‚
                     | âŸ¦âŸ§-det â†˜âŸ¦Tâ€²âŸ§â‚ â†˜âŸ¦Tâ€²âŸ§â‚‚ = ğ•Œ-irrel (ğ•Œ-trans Tâ‰ˆTâ€² Tâ‰ˆTâ€²â‚) Tâ‰ˆTâ€²â‚‚
                                                      (El-trans Tâ‰ˆTâ€² Tâ‰ˆTâ€²â‚ (ğ•Œ-trans Tâ‰ˆTâ€² Tâ‰ˆTâ€²â‚) Ï0â‰ˆÏâ€²0 Ïâ€²0â‰ˆÏâ€³0)

  âŠ¨-refl : âŠ¨ Î“ â‰ˆ Î“â€² â†’ âŠ¨ Î“ â‰ˆ Î“
  âŠ¨-refl Î“â‰ˆÎ“â€² = âŠ¨-trans Î“â‰ˆÎ“â€² (âŠ¨-sym Î“â‰ˆÎ“â€²)

  âŸ¦âŸ§Ï-refl : (Î“â‰ˆÎ“â€² : âŠ¨ Î“ â‰ˆ Î“â€²) (Î“â‰ˆÎ“ : âŠ¨ Î“ â‰ˆ Î“) â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ“â€² âŸ§Ï â†’ Ï â‰ˆ Ï âˆˆ âŸ¦ Î“â‰ˆÎ“ âŸ§Ï
  âŸ¦âŸ§Ï-refl Î“â‰ˆÎ“â€² Î“â‰ˆÎ“ Ïâ‰ˆÏâ€² = âŸ¦âŸ§Ï-trans Î“â‰ˆÎ“â€² (âŠ¨-sym Î“â‰ˆÎ“â€²) Î“â‰ˆÎ“ Ïâ‰ˆÏâ€² (âŸ¦âŸ§Ï-sym Î“â‰ˆÎ“â€² (âŠ¨-sym Î“â‰ˆÎ“â€²) Ïâ‰ˆÏâ€²)

âŠ¨-isPER : IsPartialEquivalence âŠ¨_â‰ˆ_
âŠ¨-isPER = record
  { sym   = âŠ¨-sym
  ; trans = âŠ¨-trans
  }

âŠ¨-PER : PartialSetoid _ _
âŠ¨-PER = record
  { Carrier              = Ctxs
  ; _â‰ˆ_                  = âŠ¨_â‰ˆ_
  ; isPartialEquivalence = âŠ¨-isPER
  }

module âŠ¨R = PS âŠ¨-PER

âŸ¦âŸ§Ï-swap : (Î“â‰ˆÎ“â€² : âŠ¨ Î“ â‰ˆ Î“â€²) (Î“â€²â‰ˆÎ“ : âŠ¨ Î“â€² â‰ˆ Î“) â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ“â€² âŸ§Ï â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â€²â‰ˆÎ“ âŸ§Ï
âŸ¦âŸ§Ï-swap Î“â‰ˆÎ“â€² Î“â€²â‰ˆÎ“ Ïâ‰ˆÏâ€² = âŸ¦âŸ§Ï-one-sidedâ€² (âŠ¨-refl Î“â‰ˆÎ“â€²) Î“â€²â‰ˆÎ“ (âŸ¦âŸ§Ï-one-sided Î“â‰ˆÎ“â€² (âŠ¨-refl Î“â‰ˆÎ“â€²) Ïâ‰ˆÏâ€²)

âŸ¦âŸ§Ï-symâ€² : (Î“â‰ˆÎ“â€² : âŠ¨ Î“ â‰ˆ Î“â€²) â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ“â€² âŸ§Ï â†’ Ïâ€² â‰ˆ Ï âˆˆ âŸ¦ Î“â‰ˆÎ“â€² âŸ§Ï
âŸ¦âŸ§Ï-symâ€² Î“â‰ˆÎ“â€² Ïâ‰ˆÏâ€² = âŸ¦âŸ§Ï-swap (âŠ¨-sym Î“â‰ˆÎ“â€²) Î“â‰ˆÎ“â€² (âŸ¦âŸ§Ï-sym Î“â‰ˆÎ“â€² (âŠ¨-sym Î“â‰ˆÎ“â€²) Ïâ‰ˆÏâ€²)

âŸ¦âŸ§Ï-transâ€² : (Î“â‰ˆÎ“â€² : âŠ¨ Î“ â‰ˆ Î“â€²) â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ“â€² âŸ§Ï â†’ Ïâ€² â‰ˆ Ïâ€³ âˆˆ âŸ¦ Î“â‰ˆÎ“â€² âŸ§Ï â†’ Ï â‰ˆ Ïâ€³ âˆˆ âŸ¦ Î“â‰ˆÎ“â€² âŸ§Ï
âŸ¦âŸ§Ï-transâ€² Î“â‰ˆÎ“â€² Ïâ‰ˆÏâ€² Ïâ€²â‰ˆÏâ€³ = âŸ¦âŸ§Ï-one-sided (âŠ¨-refl Î“â‰ˆÎ“â€²) Î“â‰ˆÎ“â€²
                                           (âŸ¦âŸ§Ï-trans Î“â‰ˆÎ“â€² (âŠ¨-sym Î“â‰ˆÎ“â€²) (âŠ¨-refl Î“â‰ˆÎ“â€²)
                                                      Ïâ‰ˆÏâ€² (âŸ¦âŸ§Ï-swap Î“â‰ˆÎ“â€² (âŠ¨-sym Î“â‰ˆÎ“â€²) Ïâ€²â‰ˆÏâ€³))

âŸ¦âŸ§Ï-isPER : (Î“â‰ˆÎ” : âŠ¨ Î“ â‰ˆ Î”) â†’ IsPartialEquivalence âŸ¦ Î“â‰ˆÎ” âŸ§Ï
âŸ¦âŸ§Ï-isPER Î“â‰ˆÎ” = record
  { sym   = âŸ¦âŸ§Ï-symâ€² Î“â‰ˆÎ”
  ; trans = âŸ¦âŸ§Ï-transâ€² Î“â‰ˆÎ”
  }

âŸ¦âŸ§Ï-PER : âŠ¨ Î“ â‰ˆ Î” â†’ PartialSetoid _ _
âŸ¦âŸ§Ï-PER Î“â‰ˆÎ” = record
  { Carrier              = Envs
  ; _â‰ˆ_                  = âŸ¦ Î“â‰ˆÎ” âŸ§Ï
  ; isPartialEquivalence = âŸ¦âŸ§Ï-isPER Î“â‰ˆÎ”
  }

module âŸ¦âŸ§ÏR {Î“ Î”} (Î“â‰ˆÎ” : âŠ¨ Î“ â‰ˆ Î”) = PS (âŸ¦âŸ§Ï-PER Î“â‰ˆÎ”)


âŸ¦âŸ§Ï-mon : âˆ€ (Î“â‰ˆÎ” : âŠ¨ Î“ â‰ˆ Î”) (Îº : UnMoT) â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ Î“â‰ˆÎ” âŸ§Ï â†’ Ï [ Îº ] â‰ˆ Ïâ€² [ Îº ] âˆˆ âŸ¦ Î“â‰ˆÎ” âŸ§Ï
âŸ¦âŸ§Ï-mon []-â‰ˆ Îº Ïâ‰ˆÏâ€² = tt
âŸ¦âŸ§Ï-mon {_} {_} {Ï} {Ïâ€²} (Îº-cong Î“â‰ˆÎ”) Îº (Ïâ‰ˆÏâ€² , eq)
  rewrite Ï-âˆ¥-[] Ï Îº 1
        | Ï-âˆ¥-[] Ïâ€² Îº 1
        | eq        = âŸ¦âŸ§Ï-mon Î“â‰ˆÎ” (Îº âˆ¥ L Ïâ€² 1) Ïâ‰ˆÏâ€² , refl
âŸ¦âŸ§Ï-mon {_} {_} {Ï} {Ïâ€²} (âˆ·-cong Î“â‰ˆÎ” RT) Îº (Ïâ‰ˆÏâ€² , Ï0â‰ˆÏâ€²0)
  rewrite sym (drop-mon Ï Îº)
        | sym (drop-mon Ïâ€² Îº)
        with âŸ¦âŸ§Ï-mon Î“â‰ˆÎ” Îº Ïâ‰ˆÏâ€²
...        | Ïâ‰ˆÏâ€²â‚  = Ïâ‰ˆÏâ€²â‚ , helper
  where helper : lookup Ï 0 [ Îº ] â‰ˆ lookup Ïâ€² 0 [ Îº ] âˆˆ Elâˆ (RelTyp.Tâ‰ˆTâ€² (RT Ïâ‰ˆÏâ€²â‚))
        helper
          with RT Ïâ‰ˆÏâ€² | RT Ïâ‰ˆÏâ€²â‚
        ...  | record { Tâ‰ˆTâ€² = i , Tâ‰ˆTâ€² ; nat = nat ; natâ€² = natâ€² }
             | record { â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§â‚ ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§â‚ ; Tâ‰ˆTâ€² = j , Tâ‰ˆTâ€²â‚ }
             rewrite âŸ¦âŸ§-det â†˜âŸ¦TâŸ§â‚ (nat Îº)
                   | âŸ¦âŸ§-det â†˜âŸ¦Tâ€²âŸ§â‚ (natâ€² Îº) = El-mon Tâ‰ˆTâ€² Îº Tâ‰ˆTâ€²â‚ Ï0â‰ˆÏâ€²0
