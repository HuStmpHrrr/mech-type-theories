{-# OPTIONS --without-K --safe #-}

open import Axiom.Extensionality.Propositional

module kMLTT.Completeness.Nat (fext : âˆ€ {â„“ â„“â€²} â†’ Extensionality â„“ â„“â€²) where

open import Data.Nat
open import Data.Nat.Properties

open import Lib
open import kMLTT.Completeness.LogRel
open import kMLTT.Completeness.Terms fext

open import kMLTT.Semantics.Properties.Domain fext
open import kMLTT.Semantics.Properties.Evaluation fext
open import kMLTT.Semantics.Properties.PER fext
open import kMLTT.Semantics.Readback
open import kMLTT.Semantics.Realizability fext


N-[]â€² : âˆ€ i â†’
        Î“ âŠ¨s Ïƒ âˆ¶ Î” â†’
        -----------------------
        Î“ âŠ¨ N [ Ïƒ ] â‰ˆ N âˆ¶ Se i
N-[]â€² {_} {Ïƒ} i (âŠ¨Î“ , âŠ¨Î” , âŠ¨Ïƒ) = âŠ¨Î“ , _ , helper
  where helper : Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ âŠ¨Î“ âŸ§Ï â†’ Î£ (RelTyp _ (Se i) Ï (Se i) Ïâ€²) (Î» rel â†’ RelExp (N [ Ïƒ ]) Ï N Ïâ€² (El _ (RelTyp.Tâ‰ˆTâ€² rel)))
        helper Ïâ‰ˆÏâ€² = record
                        { âŸ¦TâŸ§   = U i
                        ; âŸ¦Tâ€²âŸ§  = U i
                        ; â†˜âŸ¦TâŸ§  = âŸ¦SeâŸ§ _
                        ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦SeâŸ§ _
                        ; Tâ‰ˆTâ€²  = Uâ€² â‰¤-refl
                        }
                    , record
                        { âŸ¦tâŸ§   = N
                        ; âŸ¦tâ€²âŸ§  = N
                        ; â†˜âŸ¦tâŸ§  = âŸ¦[]âŸ§ Ïƒ.â†˜âŸ¦ÏƒâŸ§ âŸ¦NâŸ§
                        ; â†˜âŸ¦tâ€²âŸ§ = âŸ¦NâŸ§
                        ; tâ‰ˆtâ€²  = PERDef.N
                        }
          where module Ïƒ = RelSubsts (âŠ¨Ïƒ Ïâ‰ˆÏâ€²)


ze-[]â€² : Î“ âŠ¨s Ïƒ âˆ¶ Î” â†’
         ----------------------
         Î“ âŠ¨ ze [ Ïƒ ] â‰ˆ ze âˆ¶ N
ze-[]â€² {_} {Ïƒ} (âŠ¨Î“ , âŠ¨Î” , âŠ¨Ïƒ) = âŠ¨Î“ , _ , helper
  where helper : Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ âŠ¨Î“ âŸ§Ï â†’ Î£ (RelTyp 0 N Ï N Ïâ€²) (Î» rel â†’ RelExp (ze [ Ïƒ ]) Ï ze Ïâ€² (El _ (RelTyp.Tâ‰ˆTâ€² rel)))
        helper Ïâ‰ˆÏâ€² = record
                        { âŸ¦TâŸ§   = N
                        ; âŸ¦Tâ€²âŸ§  = N
                        ; â†˜âŸ¦TâŸ§  = âŸ¦NâŸ§
                        ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦NâŸ§
                        ; Tâ‰ˆTâ€²  = N
                        }
                    , record
                        { âŸ¦tâŸ§   = ze
                        ; âŸ¦tâ€²âŸ§  = ze
                        ; â†˜âŸ¦tâŸ§  = âŸ¦[]âŸ§ Ïƒ.â†˜âŸ¦ÏƒâŸ§ âŸ¦zeâŸ§
                        ; â†˜âŸ¦tâ€²âŸ§ = âŸ¦zeâŸ§
                        ; tâ‰ˆtâ€²  = ze
                        }
          where module Ïƒ = RelSubsts (âŠ¨Ïƒ Ïâ‰ˆÏâ€²)


su-[]â€² : Î“ âŠ¨s Ïƒ âˆ¶ Î” â†’
         Î” âŠ¨ t âˆ¶ N â†’
         ----------------------------------
         Î“ âŠ¨ su t [ Ïƒ ] â‰ˆ su (t [ Ïƒ ]) âˆ¶ N
su-[]â€² {_} {Ïƒ} {_} {t} (âŠ¨Î“ , âŠ¨Î” , âŠ¨Ïƒ) (âŠ¨Î”â‚ , _ , âŠ¨t) = âŠ¨Î“ , _ , helper
  where helper : Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ âŠ¨Î“ âŸ§Ï â†’ Î£ (RelTyp 0 N Ï N Ïâ€²) (Î» rel â†’ RelExp (su t [ Ïƒ ]) Ï (su (t [ Ïƒ ])) Ïâ€² (El _ (RelTyp.Tâ‰ˆTâ€² rel)))
        helper {Ï} {Ïâ€²} Ïâ‰ˆÏâ€² = help
          where module Ïƒ = RelSubsts (âŠ¨Ïƒ Ïâ‰ˆÏâ€²)
                help : Î£ (RelTyp _ N Ï N Ïâ€²) (Î» rel â†’ RelExp (su t [ Ïƒ ]) Ï (su (t [ Ïƒ ])) Ïâ€² (El _ (RelTyp.Tâ‰ˆTâ€² rel)))
                help
                  with âŠ¨t (âŠ¨-irrel âŠ¨Î” âŠ¨Î”â‚ Ïƒ.Ïƒâ‰ˆÎ´)
                ...  | record { â†˜âŸ¦TâŸ§ = âŸ¦NâŸ§ ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦NâŸ§ ; Tâ‰ˆTâ€² = N }
                     , re = record
                              { âŸ¦TâŸ§   = N
                              ; âŸ¦Tâ€²âŸ§  = N
                              ; â†˜âŸ¦TâŸ§  = âŸ¦NâŸ§
                              ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦NâŸ§
                              ; Tâ‰ˆTâ€²  = N
                              }
                          , record
                              { âŸ¦tâŸ§   = su re.âŸ¦tâŸ§
                              ; âŸ¦tâ€²âŸ§  = su re.âŸ¦tâ€²âŸ§
                              ; â†˜âŸ¦tâŸ§  = âŸ¦[]âŸ§ Ïƒ.â†˜âŸ¦ÏƒâŸ§ (âŸ¦suâŸ§ re.â†˜âŸ¦tâŸ§)
                              ; â†˜âŸ¦tâ€²âŸ§ = âŸ¦suâŸ§ (âŸ¦[]âŸ§ Ïƒ.â†˜âŸ¦Î´âŸ§ re.â†˜âŸ¦tâ€²âŸ§)
                              ; tâ‰ˆtâ€²  = su re.tâ‰ˆtâ€²
                              }
                  where module re = RelExp re


rec-helper : âˆ€ {i}
             (âŠ¨Î“ : âŠ¨ Î“)
             (Ïâ‰ˆÏâ€² : Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ âŠ¨Î“ âŸ§Ï) â†’
             (TTâ€² : (N âˆº Î“) âŠ¨ T â‰ˆ Tâ€² âˆ¶ Se i) â†’
             (ssâ€² : Î“ âŠ¨ s â‰ˆ sâ€² âˆ¶ (T [ I , ze ])) â†’
             (rrâ€² : (T âˆº N âˆº Î“) âŠ¨ r â‰ˆ râ€² âˆ¶ (T [ (wk âˆ˜ wk) , su (v 1) ])) â†’
             a â‰ˆ b âˆˆ Nat â†’
             -----------------------------------------------------
             let (_   , nâ‚ , _   ) = TTâ€²
                 (âŠ¨Î“â‚‚ , nâ‚‚ , sâ‰ˆsâ€²) = ssâ€²
                 (_   , nâ‚ƒ , _   ) = rrâ€²
                 re = projâ‚‚ (sâ‰ˆsâ€² (âŠ¨-irrel âŠ¨Î“ âŠ¨Î“â‚‚ Ïâ‰ˆÏâ€²))
             in Î£ (RelTyp (nâ‚ âŠ” nâ‚‚ âŠ” nâ‚ƒ) T (Ï â†¦ a) T (Ïâ€² â†¦ b))
                  Î» rel â†’ âˆƒâ‚‚ Î» aâ€² bâ€² â†’ recâˆ™ T , (RelExp.âŸ¦tâŸ§ re) , r , Ï , a â†˜ aâ€²
                                     Ã— recâˆ™ Tâ€² , (RelExp.âŸ¦tâ€²âŸ§ re) , râ€² , Ïâ€² , b â†˜ bâ€²
                                     Ã— (aâ€² â‰ˆ bâ€² âˆˆ El _ (RelTyp.Tâ‰ˆTâ€² rel))
rec-helper {_} {Ï} {Ïâ€²} {T} {Tâ€²} {s} {sâ€²} {r} {râ€²} {i = i} âŠ¨Î“ Ïâ‰ˆÏâ€² (âˆ·-cong âŠ¨Î“â‚ Nrelâ‚ , nâ‚ , Trelâ‚) (âŠ¨Î“â‚‚ , nâ‚‚ , sâ‰ˆsâ€²) (âˆ·-cong (âˆ·-cong âŠ¨Î“â‚ƒ Nrelâ‚ƒ) Trelâ‚ƒ , nâ‚ƒ , râ‰ˆrâ€²) aâ‰ˆb
  with âŠ¨-irrel âŠ¨Î“ âŠ¨Î“â‚‚ Ïâ‰ˆÏâ€²
...  | Ïâ‰ˆÏâ€²â‚‚ = helper aâ‰ˆb
  where
    helper : a â‰ˆ b âˆˆ Nat â†’
             let module re = RelExp (projâ‚‚ (sâ‰ˆsâ€² Ïâ‰ˆÏâ€²â‚‚))
             in Î£ (RelTyp (nâ‚ âŠ” nâ‚‚ âŠ” nâ‚ƒ) T (Ï â†¦ a) T (Ïâ€² â†¦ b))
                Î» rel â†’ âˆƒâ‚‚ Î» aâ€² bâ€² â†’ recâˆ™ T , re.âŸ¦tâŸ§ , r , Ï , a â†˜ aâ€²
                                     Ã— recâˆ™ Tâ€² , re.âŸ¦tâ€²âŸ§ , râ€² , Ïâ€² , b â†˜ bâ€²
                                     Ã— (aâ€² â‰ˆ bâ€² âˆˆ El _ (RelTyp.Tâ‰ˆTâ€² rel))
    helper ze
      with sâ‰ˆsâ€² Ïâ‰ˆÏâ€²â‚‚
    ...  | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = âŸ¦[]âŸ§ (âŸ¦,âŸ§ âŸ¦IâŸ§ âŸ¦zeâŸ§) â†˜âŸ¦TâŸ§â‚ ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦[]âŸ§ (âŸ¦,âŸ§ âŸ¦IâŸ§ âŸ¦zeâŸ§) â†˜âŸ¦Tâ€²âŸ§â‚ ; Tâ‰ˆTâ€² = Tâ‰ˆTâ€²â‚ }
          , record { âŸ¦tâŸ§ = âŸ¦sâŸ§ ; âŸ¦tâ€²âŸ§ = âŸ¦sâ€²âŸ§ ; â†˜âŸ¦tâŸ§ = _ ; â†˜âŸ¦tâ€²âŸ§ = _ ; tâ‰ˆtâ€² = sâ‰ˆsâ€² } = record
                 { âŸ¦TâŸ§  = _
                 ; âŸ¦Tâ€²âŸ§  = _
                 ; â†˜âŸ¦TâŸ§  = â†˜âŸ¦TâŸ§â‚
                 ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§â‚
                 ; Tâ‰ˆTâ€² = ğ•Œ-cumu (â‰¤-trans (mâ‰¤nâŠ”m _ _) (mâ‰¤mâŠ”n _ nâ‚ƒ)) Tâ‰ˆTâ€²â‚
                 }
               , âŸ¦sâŸ§ , âŸ¦sâ€²âŸ§ , zeâ†˜ , zeâ†˜ , El-cumu (â‰¤-trans (mâ‰¤nâŠ”m _ _) (mâ‰¤mâŠ”n _ nâ‚ƒ)) Tâ‰ˆTâ€²â‚ sâ‰ˆsâ€²
    helper {su a} {su b} (su aâ‰ˆb)
      with helper aâ‰ˆb
    ...  | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§ ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§ ; Tâ‰ˆTâ€² = Tâ‰ˆTâ€² }
         , aâ€² , bâ€² , â†˜aâ€² , â†˜bâ€² , aâ€²â‰ˆbâ€² = helper-su
      where
        Ïâ‰ˆÏâ€²â‚ƒ : drop (drop (Ï â†¦ a â†¦ aâ€²)) â‰ˆ drop (drop (Ïâ€² â†¦ b â†¦ bâ€²)) âˆˆ âŸ¦ âŠ¨Î“â‚ƒ âŸ§Ï
        Ïâ‰ˆÏâ€²â‚ƒ
          rewrite drop-â†¦ (Ï â†¦ a) aâ€²
                | drop-â†¦ (Ïâ€² â†¦ b) bâ€²
                | drop-â†¦ Ï a
                | drop-â†¦ Ïâ€² b = âŠ¨-irrel âŠ¨Î“ âŠ¨Î“â‚ƒ Ïâ‰ˆÏâ€²

        aâ‰ˆbâ‚ƒ : a â‰ˆ b âˆˆ El _ (RelTyp.Tâ‰ˆTâ€² (Nrelâ‚ƒ Ïâ‰ˆÏâ€²â‚ƒ))
        aâ‰ˆbâ‚ƒ
          with Nrelâ‚ƒ Ïâ‰ˆÏâ€²â‚ƒ
        ...  | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = _ ; â†˜âŸ¦Tâ€²âŸ§ = _ ; Tâ‰ˆTâ€² = N } = aâ‰ˆb

        aâ€²â‰ˆbâ€²â‚ƒ : aâ€² â‰ˆ bâ€² âˆˆ El _ (RelTyp.Tâ‰ˆTâ€² (Trelâ‚ƒ (Ïâ‰ˆÏâ€²â‚ƒ , aâ‰ˆbâ‚ƒ)))
        aâ€²â‰ˆbâ€²â‚ƒ
          with Trelâ‚ƒ (Ïâ‰ˆÏâ€²â‚ƒ , aâ‰ˆbâ‚ƒ)
        ...  | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§â‚ƒ ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§â‚ƒ ; Tâ‰ˆTâ€² = Tâ‰ˆTâ€²â‚ƒ }
            rewrite drop-â†¦ (Ï â†¦ a) aâ€²
                  | drop-â†¦ (Ïâ€² â†¦ b) bâ€²
                  | âŸ¦âŸ§-det â†˜âŸ¦TâŸ§ â†˜âŸ¦TâŸ§â‚ƒ
                  | âŸ¦âŸ§-det â†˜âŸ¦Tâ€²âŸ§ â†˜âŸ¦Tâ€²âŸ§â‚ƒ = ğ•Œ-irrel Tâ‰ˆTâ€² Tâ‰ˆTâ€²â‚ƒ aâ€²â‰ˆbâ€²

        helper-su : let module re = RelExp (projâ‚‚ (sâ‰ˆsâ€² Ïâ‰ˆÏâ€²â‚‚))
                    in Î£ (RelTyp (nâ‚ âŠ” nâ‚‚ âŠ” nâ‚ƒ) T (Ï â†¦ su a) T (Ïâ€² â†¦ su b))
                       Î» rel â†’ âˆƒâ‚‚ Î» aâ€² bâ€² â†’ recâˆ™ T , re.âŸ¦tâŸ§ , r , Ï , su a â†˜ aâ€²
                                            Ã— recâˆ™ Tâ€² , re.âŸ¦tâ€²âŸ§ , râ€² , Ïâ€² , su b â†˜ bâ€²
                                            Ã— (aâ€² â‰ˆ bâ€² âˆˆ El _ (RelTyp.Tâ‰ˆTâ€² rel))
        helper-su
          with râ‰ˆrâ€² ((Ïâ‰ˆÏâ€²â‚ƒ , aâ‰ˆbâ‚ƒ) , aâ€²â‰ˆbâ€²â‚ƒ)
        ... | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = âŸ¦[]âŸ§ (âŸ¦,âŸ§ (âŸ¦âˆ˜âŸ§ âŸ¦wkâŸ§ âŸ¦wkâŸ§) (âŸ¦suâŸ§ (âŸ¦vâŸ§ 1))) â†˜âŸ¦TâŸ§ ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦[]âŸ§ (âŸ¦,âŸ§ (âŸ¦âˆ˜âŸ§ âŸ¦wkâŸ§ âŸ¦wkâŸ§) (âŸ¦suâŸ§ (âŸ¦vâŸ§ 1))) â†˜âŸ¦Tâ€²âŸ§ ; Tâ‰ˆTâ€² = Tâ‰ˆTâ€² }
            , record { âŸ¦tâŸ§ = _ ; âŸ¦tâ€²âŸ§ = _ ; â†˜âŸ¦tâŸ§ = â†˜âŸ¦râŸ§ ; â†˜âŸ¦tâ€²âŸ§ = â†˜âŸ¦râ€²âŸ§ ; tâ‰ˆtâ€² = râ‰ˆrâ€² }
                rewrite drop-â†¦ (Ï â†¦ a) aâ€²
                      | drop-â†¦ (Ïâ€² â†¦ b) bâ€²
                      | drop-â†¦ Ï a
                      | drop-â†¦ Ïâ€² b = record
                            { âŸ¦TâŸ§ = _
                            ; âŸ¦Tâ€²âŸ§ = _
                            ; â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§
                            ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§
                            ; Tâ‰ˆTâ€² = ğ•Œ-cumu (mâ‰¤nâŠ”m _ _) Tâ‰ˆTâ€²
                            }
                          , _ , _ , suâ†˜ â†˜aâ€² â†˜âŸ¦râŸ§ , suâ†˜ â†˜bâ€² â†˜âŸ¦râ€²âŸ§ , El-cumu (mâ‰¤nâŠ”m _ _) Tâ‰ˆTâ€² râ‰ˆrâ€²
    helper (ne {c} {câ€²} câ‰ˆcâ€²) = helper-ne
      where
        Ïâ‰ˆÏâ€²â‚ : {a b : D} (Îº : UMoT) â†’ drop (Ï [ Îº ] â†¦ a) â‰ˆ drop (Ïâ€² [ Îº ] â†¦ b) âˆˆ âŸ¦ âŠ¨Î“â‚ âŸ§Ï
        Ïâ‰ˆÏâ€²â‚ {a} {b} Îº
          rewrite drop-â†¦ (Ï [ Îº ]) a
                | drop-â†¦ (Ïâ€² [ Îº ]) b = âŸ¦âŸ§Ï-mon âŠ¨Î“â‚ Îº (âŠ¨-irrel âŠ¨Î“ âŠ¨Î“â‚ Ïâ‰ˆÏâ€²)

        Ïâ‰ˆÏâ€²â‚â€² : {a b : D} â†’ drop (Ï â†¦ a) â‰ˆ drop (Ïâ€² â†¦ b) âˆˆ âŸ¦ âŠ¨Î“â‚ âŸ§Ï
        Ïâ‰ˆÏâ€²â‚â€² {a} {b}
          rewrite sym (Ï-ap-vone Ï)
                | sym (Ï-ap-vone Ïâ€²) = Ïâ‰ˆÏâ€²â‚ vone

        aâ‰ˆbâ‚ : {a b : D} (Îº : UMoT) â†’ a â‰ˆ b âˆˆ Nat â†’ a â‰ˆ b âˆˆ El _ (RelTyp.Tâ‰ˆTâ€² (Nrelâ‚ (Ïâ‰ˆÏâ€²â‚ {a} {b} Îº)))
        aâ‰ˆbâ‚ {a} {b} Îº aâ‰ˆb
          with Nrelâ‚ (Ïâ‰ˆÏâ€²â‚ {a} {b} Îº)
        ... | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = _ ; â†˜âŸ¦Tâ€²âŸ§ = _ ; Tâ‰ˆTâ€² = N } = aâ‰ˆb

        aâ‰ˆbâ‚â€² : {a b : D} â†’ a â‰ˆ b âˆˆ Nat â†’ a â‰ˆ b âˆˆ El _ (RelTyp.Tâ‰ˆTâ€² (Nrelâ‚ (Ïâ‰ˆÏâ€²â‚â€² {a} {b})))
        aâ‰ˆbâ‚â€² {a} {b} aâ‰ˆb
          with Nrelâ‚ (Ïâ‰ˆÏâ€²â‚â€² {a} {b})
        ... | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = _ ; â†˜âŸ¦Tâ€²âŸ§ = _ ; Tâ‰ˆTâ€² = N } = aâ‰ˆb

        helper-ne : let module re = RelExp (projâ‚‚ (sâ‰ˆsâ€² Ïâ‰ˆÏâ€²â‚‚))
                    in Î£ (RelTyp (nâ‚ âŠ” nâ‚‚ âŠ” nâ‚ƒ) T (Ï â†¦ â†‘ N c) T (Ïâ€² â†¦ â†‘ N câ€²))
                       Î» rel â†’ âˆƒâ‚‚ Î» aâ€² bâ€² â†’ recâˆ™ T , re.âŸ¦tâŸ§ , r , Ï , â†‘ N c â†˜ aâ€²
                                            Ã— recâˆ™ Tâ€² , re.âŸ¦tâ€²âŸ§ , râ€² , Ïâ€² , â†‘ N câ€² â†˜ bâ€²
                                            Ã— (aâ€² â‰ˆ bâ€² âˆˆ El _ (RelTyp.Tâ‰ˆTâ€² rel))
        helper-ne
          with RelExp-refl (âˆ·-cong âŠ¨Î“â‚ Nrelâ‚) Trelâ‚ (Ïâ‰ˆÏâ€²â‚â€² , aâ‰ˆbâ‚â€² (ne câ‰ˆcâ€²)) | Trelâ‚ (Ïâ‰ˆÏâ€²â‚â€² , aâ‰ˆbâ‚â€² (ne câ‰ˆcâ€²))
        ...  | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = âŸ¦SeâŸ§ _ ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦SeâŸ§ _ ; Tâ‰ˆTâ€² = U i<nâ‚ _ }
             , record { âŸ¦tâŸ§ = _ ; âŸ¦tâ€²âŸ§ = _ ; â†˜âŸ¦tâŸ§ = â†˜âŸ¦TâŸ§ ; â†˜âŸ¦tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§ ; tâ‰ˆtâ€² = Tâ‰ˆTâ€² }
             | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = âŸ¦SeâŸ§ _ ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦SeâŸ§ _ ; Tâ‰ˆTâ€² = U i<nâ‚â‚ _ }
             , record { âŸ¦tâŸ§ = _ ; âŸ¦tâ€²âŸ§ = _ ; â†˜âŸ¦tâŸ§ = â†˜âŸ¦TâŸ§â‚ ; â†˜âŸ¦tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§â‚ ; tâ‰ˆtâ€² = Tâ‰ˆTâ€²â‚ }
            with ğ•Œ-cumu (<â‡’â‰¤ i<nâ‚) (subst (_ â‰ˆ _ âˆˆ_) (ğ•Œ-wellfounded-â‰¡-ğ•Œ _ i<nâ‚) Tâ‰ˆTâ€²) | ğ•Œ-cumu (<â‡’â‰¤ i<nâ‚â‚) (subst (_ â‰ˆ _ âˆˆ_) (ğ•Œ-wellfounded-â‰¡-ğ•Œ _ i<nâ‚â‚) Tâ‰ˆTâ€²â‚)
        ...    | Tâ‰ˆTâ€² | Tâ‰ˆTâ€²â‚
               with âŸ¦âŸ§-det â†˜âŸ¦TâŸ§â‚ â†˜âŸ¦TâŸ§
        ...       | refl = record
                          { âŸ¦TâŸ§ = _
                          ; âŸ¦Tâ€²âŸ§ = _
                          ; â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§
                          ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§
                          ; Tâ‰ˆTâ€² = ğ•Œ-cumu (â‰¤-trans (mâ‰¤mâŠ”n _ _) (mâ‰¤mâŠ”n _ nâ‚ƒ)) Tâ‰ˆTâ€²
                          }
                        , _ , _ , recâˆ™ â†˜âŸ¦TâŸ§â‚ , recâˆ™ â†˜âŸ¦Tâ€²âŸ§â‚ , El-cumu (â‰¤-trans (mâ‰¤mâŠ”n nâ‚ nâ‚‚) (mâ‰¤mâŠ”n _ nâ‚ƒ)) Tâ‰ˆTâ€² (El-one-sided Tâ‰ˆTâ€²â‚ Tâ‰ˆTâ€² (realizability-Re Tâ‰ˆTâ€²â‚ bot-helper))
          where
            bot-helper : rec T (RelExp.âŸ¦tâŸ§ (projâ‚‚ (sâ‰ˆsâ€² Ïâ‰ˆÏâ€²â‚‚))) r Ï c â‰ˆ rec Tâ€² (RelExp.âŸ¦tâ€²âŸ§ (projâ‚‚ (sâ‰ˆsâ€² Ïâ‰ˆÏâ€²â‚‚))) râ€² Ïâ€² câ€² âˆˆ Bot
            bot-helper ns Îº
              with câ‰ˆcâ€² ns Îº | Trelâ‚ (Ïâ‰ˆÏâ€²â‚ Îº , (aâ‰ˆbâ‚ Îº (ne (Bot-l (head ns))))) | sâ‰ˆsâ€² Ïâ‰ˆÏâ€²â‚‚ | Trelâ‚ (Ïâ‰ˆÏâ€²â‚ Îº , (aâ‰ˆbâ‚ Îº ze))
            ...  | cc , câ†˜ , câ€²â†˜
                 | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = âŸ¦SeâŸ§ _ ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦SeâŸ§ _ ; Tâ‰ˆTâ€² = U i<nâ‚ns _ }
                 , record { âŸ¦tâŸ§ = âŸ¦TâŸ§ns ; âŸ¦tâ€²âŸ§ = âŸ¦Tâ€²âŸ§ns ; â†˜âŸ¦tâŸ§ = â†˜âŸ¦TâŸ§ns ; â†˜âŸ¦tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§ns ; tâ‰ˆtâ€² = Tâ‰ˆTâ€²ns }
                 | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = âŸ¦[]âŸ§ (âŸ¦,âŸ§ âŸ¦IâŸ§ âŸ¦zeâŸ§) â†˜âŸ¦TâŸ§ze ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦[]âŸ§ (âŸ¦,âŸ§ âŸ¦IâŸ§ âŸ¦zeâŸ§) â†˜âŸ¦Tâ€²âŸ§ze ; Tâ‰ˆTâ€² = Tâ‰ˆTâ€²ze }
                 , record { âŸ¦tâŸ§ = âŸ¦sâŸ§ ; âŸ¦tâ€²âŸ§ = âŸ¦sâ€²âŸ§ ; â†˜âŸ¦tâŸ§ = _ ; â†˜âŸ¦tâ€²âŸ§ = _ ; tâ‰ˆtâ€² = sâ‰ˆsâ€² }
                 | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = âŸ¦SeâŸ§ _ ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦SeâŸ§ _ ; Tâ‰ˆTâ€² = U i<nâ‚ze _ }
                 , record { âŸ¦tâŸ§ = âŸ¦TâŸ§zeâ‚ ; âŸ¦tâ€²âŸ§ = âŸ¦Tâ€²âŸ§zeâ‚ ; â†˜âŸ¦tâŸ§ = â†˜âŸ¦TâŸ§zeâ‚ ; â†˜âŸ¦tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§zeâ‚ ; tâ‰ˆtâ€² = Tâ‰ˆTâ€²zeâ‚ }
                with ğ•Œ-cumu (<â‡’â‰¤ i<nâ‚ns) (subst (_ â‰ˆ _ âˆˆ_) (ğ•Œ-wellfounded-â‰¡-ğ•Œ _ i<nâ‚ns) Tâ‰ˆTâ€²ns)
                   | ğ•Œ-cumu (<â‡’â‰¤ i<nâ‚ze) (subst (_ â‰ˆ _ âˆˆ_) (ğ•Œ-wellfounded-â‰¡-ğ•Œ _ i<nâ‚ze) Tâ‰ˆTâ€²zeâ‚)
            ...    | Tâ‰ˆTâ€²ns
                   | Tâ‰ˆTâ€²zeâ‚
                  with realizability-Re Tâ‰ˆTâ€²ns (Bot-l (head ns))
            ...      | aâ€²â‰ˆbâ€² = bot-helperâ€²
              where
                Ïâ‰ˆÏâ€²â‚ƒ : drop (drop (Ï [ Îº ] â†¦ lâ€² N (head ns) â†¦ lâ€² âŸ¦TâŸ§ns (suc (head ns)))) â‰ˆ drop (drop (Ïâ€² [ Îº ] â†¦ lâ€² N (head ns) â†¦ lâ€² âŸ¦Tâ€²âŸ§ns (suc (head ns)))) âˆˆ âŸ¦ âŠ¨Î“â‚ƒ âŸ§Ï
                Ïâ‰ˆÏâ€²â‚ƒ
                  rewrite drop-â†¦ (Ï [ Îº ] â†¦ lâ€² N (head ns)) (lâ€² âŸ¦TâŸ§ns (suc (head ns)))
                        | drop-â†¦ (Ïâ€² [ Îº ] â†¦ lâ€² N (head ns)) (lâ€² âŸ¦Tâ€²âŸ§ns (suc (head ns)))
                        | drop-â†¦ (Ï [ Îº ]) (lâ€² N (head ns))
                        | drop-â†¦ (Ïâ€² [ Îº ]) (lâ€² N (head ns)) = âŸ¦âŸ§Ï-mon âŠ¨Î“â‚ƒ Îº (âŠ¨-irrel âŠ¨Î“ âŠ¨Î“â‚ƒ Ïâ‰ˆÏâ€²)

                aâ‰ˆbâ‚ƒ : lâ€² N (head ns) â‰ˆ lâ€² N (head ns) âˆˆ El _ (RelTyp.Tâ‰ˆTâ€² (Nrelâ‚ƒ Ïâ‰ˆÏâ€²â‚ƒ))
                aâ‰ˆbâ‚ƒ
                  with Nrelâ‚ƒ Ïâ‰ˆÏâ€²â‚ƒ
                ...  | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = _ ; â†˜âŸ¦Tâ€²âŸ§ = _ ; Tâ‰ˆTâ€² = N } = ne (Bot-l (head ns))

                aâ€²â‰ˆbâ€²â‚ƒ : lâ€² âŸ¦TâŸ§ns (suc (head ns)) â‰ˆ lâ€² âŸ¦Tâ€²âŸ§ns (suc (head ns)) âˆˆ El _ (RelTyp.Tâ‰ˆTâ€² (Trelâ‚ƒ (Ïâ‰ˆÏâ€²â‚ƒ , aâ‰ˆbâ‚ƒ)))
                aâ€²â‰ˆbâ€²â‚ƒ
                  with Trelâ‚ƒ (Ïâ‰ˆÏâ€²â‚ƒ , aâ‰ˆbâ‚ƒ)
                ...  | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = â†˜âŸ¦TâŸ§â‚ƒ ; â†˜âŸ¦Tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§â‚ƒ ; Tâ‰ˆTâ€² = Tâ‰ˆTâ€²â‚ƒ }
                    rewrite drop-â†¦ (Ï [ Îº ] â†¦ lâ€² N (head ns)) (lâ€² âŸ¦TâŸ§ns (suc (head ns)))
                          | drop-â†¦ (Ïâ€² [ Îº ] â†¦ lâ€² N (head ns)) (lâ€² âŸ¦Tâ€²âŸ§ns (suc (head ns)))
                          | âŸ¦âŸ§-det â†˜âŸ¦TâŸ§ns â†˜âŸ¦TâŸ§â‚ƒ = El-one-sided Tâ‰ˆTâ€²ns Tâ‰ˆTâ€²â‚ƒ (realizability-Re Tâ‰ˆTâ€²ns (Bot-l (suc (head ns))))

                bot-helperâ€² : âˆƒ Î» u â†’ Re ns - rec T âŸ¦sâŸ§ r Ï c [ Îº ] â†˜ u Ã— Re ns - rec Tâ€² âŸ¦sâ€²âŸ§ râ€² Ïâ€² câ€² [ Îº ] â†˜ u
                bot-helperâ€²
                  with râ‰ˆrâ€² ((Ïâ‰ˆÏâ€²â‚ƒ , aâ‰ˆbâ‚ƒ) , aâ€²â‰ˆbâ€²â‚ƒ) | Trelâ‚ (Ïâ‰ˆÏâ€²â‚ Îº , (aâ‰ˆbâ‚ Îº (su (ne (Bot-l (head ns))))))
                ...  | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = âŸ¦[]âŸ§ (âŸ¦,âŸ§ (âŸ¦âˆ˜âŸ§ âŸ¦wkâŸ§ âŸ¦wkâŸ§) (âŸ¦suâŸ§ (âŸ¦vâŸ§ 1))) â†˜âŸ¦TâŸ§su ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦[]âŸ§ (âŸ¦,âŸ§ (âŸ¦âˆ˜âŸ§ âŸ¦wkâŸ§ âŸ¦wkâŸ§) (âŸ¦suâŸ§ (âŸ¦vâŸ§ 1))) â†˜âŸ¦Tâ€²âŸ§su ; Tâ‰ˆTâ€² = Tâ‰ˆTâ€²su }
                     , record { âŸ¦tâŸ§ = âŸ¦râŸ§ ; âŸ¦tâ€²âŸ§ = âŸ¦râ€²âŸ§ ; â†˜âŸ¦tâŸ§ = â†˜âŸ¦râŸ§ ; â†˜âŸ¦tâ€²âŸ§ = â†˜âŸ¦râ€²âŸ§ ; tâ‰ˆtâ€² = râ‰ˆrâ€² }
                     | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = âŸ¦SeâŸ§ _ ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦SeâŸ§ _ ; Tâ‰ˆTâ€² = U i<nâ‚su _ }
                     , record { âŸ¦tâŸ§ = âŸ¦TâŸ§suâ‚ ; âŸ¦tâ€²âŸ§ = âŸ¦Tâ€²âŸ§suâ‚ ; â†˜âŸ¦tâŸ§ = â†˜âŸ¦TâŸ§suâ‚ ; â†˜âŸ¦tâ€²âŸ§ = â†˜âŸ¦Tâ€²âŸ§suâ‚ ; tâ‰ˆtâ€² = Tâ‰ˆTâ€²suâ‚ }
                    with ğ•Œ-cumu (<â‡’â‰¤ i<nâ‚su) (subst (_ â‰ˆ _ âˆˆ_) (ğ•Œ-wellfounded-â‰¡-ğ•Œ _ i<nâ‚su) Tâ‰ˆTâ€²suâ‚)
                ...    | Tâ‰ˆTâ€²suâ‚
                      rewrite drop-â†¦ (Ï [ Îº ] â†¦ lâ€² N (head ns)) (lâ€² âŸ¦TâŸ§ns (suc (head ns)))
                            | drop-â†¦ (Ïâ€² [ Îº ] â†¦ lâ€² N (head ns)) (lâ€² âŸ¦Tâ€²âŸ§ns (suc (head ns)))
                            | drop-â†¦ (Ï [ Îº ]) (lâ€² N (head ns))
                            | drop-â†¦ (Ïâ€² [ Îº ]) (lâ€² N (head ns))
                            | sym (â†¦-mon Ï ze Îº)
                            | âŸ¦âŸ§-det â†˜âŸ¦TâŸ§zeâ‚ (âŸ¦âŸ§-mon Îº â†˜âŸ¦TâŸ§ze)
                            | âŸ¦âŸ§-det â†˜âŸ¦TâŸ§su â†˜âŸ¦TâŸ§suâ‚
                        with realizability-Rty Tâ‰ˆTâ€²ns (inc ns) vone
                           | realizability-Rf Tâ‰ˆTâ€²zeâ‚ (El-one-sided (ğ•Œ-mon Îº Tâ‰ˆTâ€²ze) Tâ‰ˆTâ€²zeâ‚ (El-mon Tâ‰ˆTâ€²ze Îº (ğ•Œ-mon Îº Tâ‰ˆTâ€²ze) sâ‰ˆsâ€²)) ns vone
                           | realizability-Rf Tâ‰ˆTâ€²suâ‚ (El-one-sided Tâ‰ˆTâ€²su Tâ‰ˆTâ€²suâ‚ râ‰ˆrâ€²) (inc (inc ns)) vone
                ...        | _ , RU _ Tnsâ†˜ , RU _ Tâ€²nsâ†˜
                           | _ , Tzeâ†˜ , Tâ€²zeâ†˜
                           | _ , Tsuâ†˜ , Tâ€²suâ†˜
                          rewrite D-ap-vone âŸ¦TâŸ§ns
                                | D-ap-vone âŸ¦Tâ€²âŸ§ns
                                | âŸ¦âŸ§-det (âŸ¦âŸ§-mon Îº â†˜âŸ¦TâŸ§ze) â†˜âŸ¦TâŸ§zeâ‚
                                | â†¦-mon Ï ze Îº
                                | D-ap-vone âŸ¦TâŸ§zeâ‚
                                | D-ap-vone âŸ¦Tâ€²âŸ§zeâ‚
                                | D-ap-vone (âŸ¦sâŸ§ [ Îº ])
                                | D-ap-vone (âŸ¦sâ€²âŸ§ [ Îº ])
                                | D-ap-vone âŸ¦TâŸ§suâ‚
                                | D-ap-vone âŸ¦Tâ€²âŸ§suâ‚
                                | D-ap-vone âŸ¦râŸ§
                                | D-ap-vone âŸ¦râ€²âŸ§ = rec _ _ _ cc , Rr ns â†˜âŸ¦TâŸ§ns Tnsâ†˜ â†˜âŸ¦TâŸ§zeâ‚ Tzeâ†˜ â†˜âŸ¦râŸ§ â†˜âŸ¦TâŸ§suâ‚ Tsuâ†˜ câ†˜ , Rr ns â†˜âŸ¦Tâ€²âŸ§ns Tâ€²nsâ†˜ â†˜âŸ¦Tâ€²âŸ§zeâ‚ Tâ€²zeâ†˜ â†˜âŸ¦râ€²âŸ§ â†˜âŸ¦Tâ€²âŸ§suâ‚ Tâ€²suâ†˜ câ€²â†˜


-- -- -- rec-[]     : âˆ€ {i} â†’
-- -- --              Î“ âŠ¨s Ïƒ âˆ¶ Î” â†’
-- -- --              N âˆº Î” âŠ¨ T âˆ¶ Se i â†’
-- -- --              Î” âŠ¨ s âˆ¶ T [| ze ] â†’
-- -- --              T âˆº N âˆº Î” âŠ¨ r âˆ¶ T [ (wk âˆ˜ wk) , su (v 1) ] â†’
-- -- --              Î” âŠ¨ t âˆ¶ N â†’
-- -- --              -----------------------------------------------------------------------------------------------
-- -- --              Î“ âŠ¨ rec T s r t [ Ïƒ ] â‰ˆ rec (T [ q Ïƒ ]) (s [ Ïƒ ]) (r [ q (q Ïƒ) ]) (t [ Ïƒ ]) âˆ¶ T [ Ïƒ , t [ Ïƒ ] ]

N-â‰ˆâ€² : âˆ€ {i} â†’
       âŠ¨ Î“ â†’
       ----------------
       Î“ âŠ¨ N â‰ˆ N âˆ¶ Se i
N-â‰ˆâ€² {_} {i} âŠ¨Î“ = âŠ¨Î“ , suc i , Î» Ïâ‰ˆÏâ€² â†’ record
                             { âŸ¦TâŸ§   = U _
                             ; âŸ¦Tâ€²âŸ§  = U _
                             ; â†˜âŸ¦TâŸ§  = âŸ¦SeâŸ§ _
                             ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦SeâŸ§ _
                             ; Tâ‰ˆTâ€²  = U (n<1+n _) refl
                             }
                           , record
                             { âŸ¦tâŸ§   = N
                             ; âŸ¦tâ€²âŸ§  = N
                             ; â†˜âŸ¦tâŸ§  = âŸ¦NâŸ§
                             ; â†˜âŸ¦tâ€²âŸ§ = âŸ¦NâŸ§
                             ; tâ‰ˆtâ€²  = subst (_ â‰ˆ _ âˆˆ_) (sym (ğ•Œ-wellfounded-â‰¡-ğ•Œ _ (n<1+n _))) N
                             }

ze-â‰ˆâ€² : âŠ¨ Î“ â†’
        ----------------
        Î“ âŠ¨ ze â‰ˆ ze âˆ¶ N
ze-â‰ˆâ€² âŠ¨Î“ = âŠ¨Î“ , 0 , Î» Ïâ‰ˆÏâ€² â†’ record
                             { âŸ¦TâŸ§   = N
                             ; âŸ¦Tâ€²âŸ§  = N
                             ; â†˜âŸ¦TâŸ§  = âŸ¦NâŸ§
                             ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦NâŸ§
                             ; Tâ‰ˆTâ€²  = N
                             }
                           , record
                             { âŸ¦tâŸ§   = ze
                             ; âŸ¦tâ€²âŸ§  = ze
                             ; â†˜âŸ¦tâŸ§  = âŸ¦zeâŸ§
                             ; â†˜âŸ¦tâ€²âŸ§ = âŸ¦zeâŸ§
                             ; tâ‰ˆtâ€²  = ze
                             }

su-â‰ˆâ€² : âŠ¨ Î“ â†’
        Î“ âŠ¨ t â‰ˆ tâ€² âˆ¶ N â†’
        ----------------
        Î“ âŠ¨ su t â‰ˆ su tâ€² âˆ¶ N
su-â‰ˆâ€² {_} {t} {tâ€²} âŠ¨Î“ (âŠ¨Î“â‚ , n , tâ‰ˆtâ€²) = âŠ¨Î“ , _ , helper
  where
    helper : {Ï Ïâ€² : Envs} â†’ Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ âŠ¨Î“ âŸ§Ï â†’ Î£ (RelTyp n N Ï N Ïâ€²) (Î» rel â†’ RelExp (su t) Ï (su tâ€²) Ïâ€² (El _ (RelTyp.Tâ‰ˆTâ€² rel)))
    helper Ïâ‰ˆÏâ€²
      with tâ‰ˆtâ€² (âŠ¨-irrel âŠ¨Î“ âŠ¨Î“â‚ Ïâ‰ˆÏâ€²)
    ...  | record { âŸ¦TâŸ§ = _ ; âŸ¦Tâ€²âŸ§ = _ ; â†˜âŸ¦TâŸ§ = _ ; â†˜âŸ¦Tâ€²âŸ§ = _ ; Tâ‰ˆTâ€² = N }
         , record { âŸ¦tâŸ§ = _ ; âŸ¦tâ€²âŸ§ = _ ; â†˜âŸ¦tâŸ§ = â†˜âŸ¦tâŸ§ ; â†˜âŸ¦tâ€²âŸ§ = â†˜âŸ¦tâ€²âŸ§ ; tâ‰ˆtâ€² = tâ‰ˆtâ€² } = record
                        { âŸ¦TâŸ§   = N
                        ; âŸ¦Tâ€²âŸ§  = N
                        ; â†˜âŸ¦TâŸ§  = âŸ¦NâŸ§
                        ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦NâŸ§
                        ; Tâ‰ˆTâ€²  = N
                        }
                      , record
                        { âŸ¦tâŸ§   = _
                        ; âŸ¦tâ€²âŸ§  = _
                        ; â†˜âŸ¦tâŸ§  = âŸ¦suâŸ§ â†˜âŸ¦tâŸ§
                        ; â†˜âŸ¦tâ€²âŸ§ = âŸ¦suâŸ§ â†˜âŸ¦tâ€²âŸ§
                        ; tâ‰ˆtâ€²  = su tâ‰ˆtâ€²
                        }
  

-- -- su-congâ€² : Î“ âŠ¨ t â‰ˆ tâ€² âˆ¶ N â†’
-- --            ---------------------
-- --            Î“ âŠ¨ su t â‰ˆ su tâ€² âˆ¶ N
-- -- su-congâ€² {_} {t} {tâ€²} (âŠ¨Î“ , tâ‰ˆtâ€²) = âŠ¨Î“ , helper
-- --   where helper : Ï â‰ˆ Ïâ€² âˆˆ âŸ¦ âŠ¨Î“ âŸ§Ï â†’ Î£ (RelTyp N Ï N Ïâ€²) (Î» rel â†’ RelExp (su t) Ï (su tâ€²) Ïâ€² (El _ (RelTyp.Tâ‰ˆTâ€² rel)))
-- --         helper Ïâ‰ˆÏâ€²
-- --           with tâ‰ˆtâ€² Ïâ‰ˆÏâ€²
-- --         ...  | record { â†˜âŸ¦TâŸ§ = âŸ¦NâŸ§ ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦NâŸ§ ; Tâ‰ˆTâ€² = _ , N }
-- --              , re = record
-- --                       { âŸ¦TâŸ§   = N
-- --                       ; âŸ¦Tâ€²âŸ§  = N
-- --                       ; â†˜âŸ¦TâŸ§  = âŸ¦NâŸ§
-- --                       ; â†˜âŸ¦Tâ€²âŸ§ = âŸ¦NâŸ§
-- --                       ; Tâ‰ˆTâ€²  = 0 , N
-- --                       }
-- --                   , record
-- --                       { âŸ¦tâŸ§   = su re.âŸ¦tâŸ§
-- --                       ; âŸ¦tâ€²âŸ§  = su re.âŸ¦tâ€²âŸ§
-- --                       ; â†˜âŸ¦tâŸ§  = âŸ¦suâŸ§ re.â†˜âŸ¦tâŸ§
-- --                       ; â†˜âŸ¦tâ€²âŸ§ = âŸ¦suâŸ§ re.â†˜âŸ¦tâ€²âŸ§
-- --                       ; tâ‰ˆtâ€²  = su re.tâ‰ˆtâ€²
-- --                       }
-- --           where module re = RelExp re


-- -- -- rec-cong   : âˆ€ {i} â†’
-- -- --              N âˆº Î“ âŠ¨ T â‰ˆ Tâ€² âˆ¶ Se i â†’
-- -- --              Î“ âŠ¨ s â‰ˆ sâ€² âˆ¶ T [ I , ze ] â†’
-- -- --              T âˆº N âˆº Î“ âŠ¨ r â‰ˆ râ€² âˆ¶ T [ (wk âˆ˜ wk) , su (v 1) ] â†’
-- -- --              Î“ âŠ¨ t â‰ˆ tâ€² âˆ¶ N â†’
-- -- --              --------------------------------------------
-- -- --              Î“ âŠ¨ rec T s r t â‰ˆ rec Tâ€² sâ€² râ€² tâ€² âˆ¶ T [| t ]
-- -- -- rec-Î²-ze   : âˆ€ {i} â†’
-- -- --              N âˆº Î“ âŠ¨ T âˆ¶ Se i â†’
-- -- --              Î“ âŠ¨ s âˆ¶ T [| ze ] â†’
-- -- --              T âˆº N âˆº Î“ âŠ¨ r âˆ¶ T [ (wk âˆ˜ wk) , su (v 1) ] â†’
-- -- --              ---------------------------------------------
-- -- --              Î“ âŠ¨ rec T s r ze â‰ˆ s âˆ¶ T [| ze ]
-- -- -- rec-Î²-su   : âˆ€ {i} â†’
-- -- --              N âˆº Î“ âŠ¨ T âˆ¶ Se i â†’
-- -- --              Î“ âŠ¨ s âˆ¶ T [| ze ] â†’
-- -- --              T âˆº N âˆº Î“ âŠ¨ r âˆ¶ T [ (wk âˆ˜ wk) , su (v 1) ] â†’
-- -- --              Î“ âŠ¨ t âˆ¶ N â†’
-- -- --              -----------------------------------------------------------------
-- -- --              Î“ âŠ¨ rec T s r (su t) â‰ˆ r [ (I , t) , rec T s r t ] âˆ¶ T [| su t ]
